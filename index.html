<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Creative Portfolio ‚Äî Modern Graphic</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
  /* ==========================================
     PREMIUM GALLERY ‚Äî DARK / GRAY LARGE-CARD UI
     ========================================== */
  :root{
    --bg:#111;
    --text:#ffffff;
    --muted:#aaaaaa;
    --accent:#ffffff;
    --card:#1a1a1a;
    --border:#2a2a2a;
    --radius:6px;
  }

  html,body{
    margin:0;
    height:100%;
    font-family:'Inter','Prompt',sans-serif;
    background:var(--bg);
    color:var(--text);
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:22px 10px;
    border-bottom:1px solid var(--border);
  }

  .logo{
    width:60px;
    height:60px;
    background:var(--card);
    border:2px solid var(--border);
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    font-weight:900;
    font-size:22px;
    border-radius:var(--radius);
  }

  .title{font-size:24px;font-weight:900;color:var(--text)}
  .subtitle{font-size:14px;color:var(--muted)}

  .mode-btn{
    padding:10px 20px;
    font-size:14px;
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    font-weight:700;
    color:var(--text);
  }
  .mode-btn.active{
    background:var(--accent);
    color:#000;
  }

  .grid-main{
    display:grid;
    grid-template-columns:320px 1fr;
    gap:30px;
    margin-top:20px;
  }

  .panel{
    background:var(--card);
    padding:24px;
    border:1px solid var(--border);
    border-radius:var(--radius);
  }

  /* HERO */
  .hero{
    height:260px;
    border-radius:var(--radius);
    background:linear-gradient(#1b1b1b,#141414);
    border:1px solid var(--border);
    display:flex;
    align-items:center;
    padding:24px;
  }

  .avatar{
    width:100px;height:100px;border-radius:50%;overflow:hidden;background:#222;
    display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:800;
    border:2px solid var(--border);
    color:white;
  }

  .hero-title{font-size:26px;font-weight:900;margin-bottom:4px}
  .hero-tag{font-size:14px;color:var(--muted)}

  .meta-pill{
    padding:6px 12px;
    background:#000;
    border:1px solid var(--border);
    border-radius:var(--radius);
    font-size:12px;
    color:var(--text);
  }

  .card-title{
    font-weight:900;
    font-size:16px;
    color:var(--accent);
    margin-bottom:8px;
  }

  /* BIG GALLERY WORK CARDS */
  .works-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(380px,1fr));
    gap:28px;
  }

  .work-card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    overflow:hidden;
    transition:0.25s;
  }
  .work-card:hover{
    transform:translateY(-6px);
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
  }

  .work-thumb{
    height:260px;
    background:#333;
    overflow:hidden;
  }

  .work-title{
    font-weight:800;
    font-size:17px;
    margin:14px;
    color:var(--text);
  }

  .btn-primary{
    background:var(--text);
    color:#000;
    padding:10px 16px;
    border-radius:var(--radius);
    font-weight:800;
    border:none;
  }
  .btn-ghost{
    background:var(--card);
    color:var(--text);
    padding:8px 12px;
    border-radius:var(--radius);
    border:1px solid var(--border);
    font-weight:700;
  }

  input,textarea{
    border:1px solid var(--border);
    padding:10px;
    border-radius:var(--radius);
    background:#000;
    color:var(--text);
    font-size:14px;
  }

  .modal-backdrop{background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);}
  .modal-card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:20px;
  }

  @media(max-width:900px){ .grid-main{grid-template-columns:1fr;} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CP</div>
        <div>
          <div class="title">Creative Portfolio</div>
          <div class="subtitle">Modern Graphic ‚Äî Viewer / Admin</div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <button id="viewerModeBtn" class="mode-btn active">Portfolio</button>
        <button id="adminModeBtn" class="mode-btn">Dashboard</button>
      </div>
    </header>

    <div class="grid-main">
      <!-- LEFT: profile & lists -->
      <aside>
        <div class="panel">
          <div class="hero">
            <div class="pattern"></div>
            <div style="display:flex;align-items:center;z-index:2">
              <div class="avatar" id="avatar-wrap">üé®<img id="profile-avatar-img" class="w-full h-full object-cover hidden" alt="avatar"></div>
              <div class="hero-info">
                <div class="hero-title" id="hero-title">‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô</div>
                <div class="hero-tag" id="hero-tagline">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏¢‡πà‡∏≠ ‚Äî Modern Graphic</div>
                <div class="hero-meta">
                  <a id="facebook-link" class="meta-pill" href="#" target="_blank">Facebook</a>
                  <div class="meta-pill muted" id="work-overview-text">Portfolio ‚Äî 0 ‡∏ä‡∏¥‡πâ‡∏ô</div>
                </div>
              </div>
            </div>
          </div>

          <div class="left-sections">
            <div class="panel" style="padding:12px">
              <div class="card-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Quick)</div>
              <div id="pb-content" class="muted" style="font-size:13px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            </div>

            <div class="panel" style="padding:12px">
              <div class="card-title">‡∏ó‡∏±‡∏Å‡∏©‡∏∞</div>
              <div id="skills-list" style="display:flex;flex-wrap:wrap;gap:8px"></div>
            </div>

            <div class="panel" style="padding:12px;display:flex;flex-direction:column;gap:8px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="card-title">‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
                <button id="nav-bio" class="btn-ghost">‡∏î‡∏π</button>
              </div>
              <div id="education-viewer" class="muted" style="font-size:13px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
            </div>

          </div>
        </div>
      </aside>

      <!-- RIGHT: content area -->
      <section>
        <div id="viewer-section" class="panel">
          <nav style="display:flex;gap:10px;margin-bottom:12px">
            <button id="nav-bio-top" class="btn-ghost">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</button>
            <button id="nav-work-top" class="btn-ghost">‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
            <button id="nav-fav-top" class="btn-ghost">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö</button>
          </nav>

          <div id="viewer-content">
            <div id="personal-bio-view" class="hidden">
              <div class="card-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
              <div id="pb-detailed" class="muted">‚Äî</div>
            </div>

            <div id="work-section" class="hidden">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                <div class="card-title">Selected Works</div>
                <div class="muted" id="work-stats">0 ‡∏ä‡∏¥‡πâ‡∏ô</div>
              </div>
              <div id="work-grid" class="works-grid"></div>
            </div>

            <div id="favorites-section" class="hidden">
              <div class="card-title">Favorites</div>
              <div id="favorites-list" class="muted"></div>
            </div>
          </div>
        </div>

        <div id="admin-section" class="panel hidden" style="margin-top:14px">
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button id="menu-profile-settings" class="btn-ghost">1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
            <button id="menu-personal-bio" class="btn-ghost">2. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
            <button id="menu-work-manage" class="btn-ghost">3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
            <button id="menu-favorites" class="btn-ghost">4. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö</button>
          </div>

          <div id="admin-forms" style="margin-top:12px">
            <div id="section-profile" style="margin-top:12px">
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                <input id="artist-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô" />
                <input id="artist-facebook" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå Facebook" />
                <textarea id="artist-bio" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ï‡πâ‡∏ä‡∏∑‡πà‡∏≠" style="grid-column:1 / -1"></textarea>
                <input id="banner-upload" type="file" accept="image/*" />
                <input id="avatar-upload" type="file" accept="image/*" />
                <button id="save-profile-btn" class="btn-primary" style="grid-column:1 / -1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
              </div>
            </div>

            <div id="section-bio" class="hidden" style="margin-top:12px">
              <!-- condensed admin bio controls kept as before -->
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                <input id="pi_fullname" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
                <input id="pi_dob" type="date" />
                <input id="pi_address" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà" style="grid-column:1 / -1" />
                <input id="pi_phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå" />
                <input id="pi_email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" />
                <input id="pi_status" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û" />
                <input id="pi_nationality" placeholder="‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥/‡∏®‡∏≤‡∏™‡∏ô‡∏≤" />
                <button id="save-personal-info" class="btn-primary" style="grid-column:1 / -1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</button>
              </div>
            </div>

            <div id="section-works" class="hidden" style="margin-top:12px">
              <div style="display:flex;gap:10px;margin-bottom:10px">
                <button id="add-work-btn" class="btn-primary">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
                <button id="clear-work-btn" class="btn-ghost">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
              </div>
              <div id="work-list" style="display:flex;flex-direction:column;gap:10px"></div>
            </div>

            <div id="section-favs" class="hidden" style="margin-top:12px">
              <div style="display:flex;gap:10px;margin-bottom:10px">
                <button id="add-fav-btn" class="btn-primary">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                <button id="clear-fav-btn" class="btn-ghost">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
              </div>
              <div id="favorites-list-admin" style="display:flex;flex-direction:column;gap:8px"></div>
            </div>

          </div>
        </div>

      </section>
    </div>

    <!-- modal root & popup area -->
    <div id="modal-root" class="modal-backdrop hidden"><div id="modal-card" class="modal-card"></div></div>
    <div id="popup-area"></div>
  </div>

<script>
// keep original Supabase + logic but wire to new DOM structure
const SUPABASE_URL = 'https://yrivvckaeqhfcjuputem.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlyaXZ2Y2thZXFoZmNqdXB1dGVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MjYzNjksImV4cCI6MjA4MDAwMjM2OX0.Hw7rtrJyXS6sClytRKSYutvW7Co5l_jmbOUOduo30u0';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, { auth: { persistSession: false } });
const USER_ID = 1;

function el(id){ return document.getElementById(id); }
function showPopup(text){ const p = document.createElement('div'); p.className='popup'; p.innerText=text; document.body.appendChild(p); setTimeout(()=>p.remove(),2200); }
function showModal(html){ el('modal-card').innerHTML = html; el('modal-root').classList.remove('hidden'); }
function closeModal(){ el('modal-root').classList.add('hidden'); el('modal-card').innerHTML = ''; }

// quick nav wiring
el('viewerModeBtn').onclick = ()=>{ el('viewer-section').classList.remove('hidden'); el('admin-section').classList.add('hidden'); el('viewerModeBtn').classList.add('active'); el('adminModeBtn').classList.remove('active'); };
el('adminModeBtn').onclick = ()=>{ el('viewer-section').classList.add('hidden'); el('admin-section').classList.remove('hidden'); el('adminModeBtn').classList.add('active'); el('viewerModeBtn').classList.remove('active'); };

// viewer tabs
el('nav-bio-top').onclick = async ()=>{ setActiveViewer('personal-bio-view'); await loadViewerBio(); };
el('nav-work-top').onclick = ()=>{ setActiveViewer('work-section'); loadWorksViewer(); };
el('nav-fav-top').onclick = ()=>{ setActiveViewer('favorites-section'); loadFavoritesViewer(); };
function setActiveViewer(id){ ['personal-bio-view','work-section','favorites-section'].forEach(s=> el(s).classList.add('hidden')); el(id).classList.remove('hidden'); }

// reuse CRUD helpers from original
async function fetchTable(table){ try{ const { data, error } = await supabase.from(table).select('*').eq('user_id', USER_ID).order('id', { ascending: false }); if(error) throw error; return data||[]; }catch(e){ console.warn(e); return []; } }
async function insertTable(table, record){ try{ const { data, error } = await supabase.from(table).insert([{ ...record, user_id: USER_ID }]).select(); if(error) throw error; return data?.[0]||null; }catch(e){ console.warn(e); return null; } }
async function updateTable(table, id, changes){ try{ const { data, error } = await supabase.from(table).update(changes).eq('id', id).eq('user_id', USER_ID).select(); if(error) throw error; return data?.[0]||null; }catch(e){ console.warn(e); return null; } }
async function deleteTable(table, id){ try{ const { error } = await supabase.from(table).delete().eq('id', id).eq('user_id', USER_ID); if(error) throw error; return true; }catch(e){ console.warn(e); return false; } }
async function deleteAll(table){ try{ const { error } = await supabase.from(table).delete().eq('user_id', USER_ID); if(error) throw error; return true; }catch(e){ console.warn(e); return false; } }

// profile load (adapted selectors)
async function loadProfile(){ try{ const { data } = await supabase.from('profile').select('*').eq('id',1).single(); if(!data) return; if(data.banner_url) document.querySelector('.hero').style.backgroundImage = `url(${data.banner_url})`; if(data.avatar_url){ const img = el('profile-avatar-img'); img.src = data.avatar_url; img.classList.remove('hidden'); el('avatar-wrap').textContent=''; el('avatar-wrap').appendChild(img); } el('hero-title').textContent = data.name||''; el('hero-tagline').textContent = data.bio||''; el('facebook-link').href = data.facebook||'#'; }catch(e){ console.warn('loadProfile',e); } }

el('save-profile-btn').onclick = async ()=>{
  const name = el('artist-name').value.trim(); const bio = el('artist-bio').value.trim(); const facebook = el('artist-facebook').value.trim();
  const bannerFile = el('banner-upload')?.files?.[0]||null; const avatarFile = el('avatar-upload')?.files?.[0]||null;
  async function uploadFile(bucket, file){ if(!file) return null; const path = `${Date.now()}-${file.name}`; const res = await supabase.storage.from(bucket).upload(path, file); if(res.error) { console.warn(res.error); return null; } const url = await supabase.storage.from(bucket).getPublicUrl(path); return url?.data?.publicUrl||null; }
  let bannerUrl = null; let avatarUrl = null; if(bannerFile) bannerUrl = await uploadFile('profile-data', bannerFile); if(avatarFile) avatarUrl = await uploadFile('profile-data', avatarFile);
  const payload = { id:1, name, bio, facebook, banner_url: bannerUrl, avatar_url: avatarUrl };
  try{ const { error } = await supabase.from('profile').upsert(payload); if(error) throw error; showPopup('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); await loadProfile(); }catch(e){ alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); console.error(e); }
};

// skills
el('add-fav-btn')?.addEventListener('click', ()=>{ showModal(`<div style='padding:12px'><h3 class='card-title'>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö</h3><input id='fav-title' class='w-full' placeholder='‡∏ä‡∏∑‡πà‡∏≠' /><input id='fav-desc' class='w-full' placeholder='‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢' style='margin-top:8px' /><div style='text-align:right;margin-top:10px'><button onclick='closeModal()' class='btn-ghost'>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button id='modal-fav-save' class='btn-primary'>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></div>`); setTimeout(()=>{ document.getElementById('modal-card').querySelector('#modal-fav-save').onclick = async ()=>{ const title = el('fav-title').value.trim(); const desc = el('fav-desc').value.trim()||null; if(!title){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠'); return; } await insertTable('favorites', { title, description: desc }); showPopup('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); closeModal(); loadFavoritesAdmin(); loadFavoritesViewer(); } },50); });

// load skills into left panel
async function loadSkillsAdmin(){ const list = await fetchTable('skills'); const box = el('skills-list'); if(!box) return; box.innerHTML=''; list.forEach(s=>{ const tag = document.createElement('div'); tag.style.padding='6px 10px'; tag.style.border='1px solid rgba(255,255,255,0.03)'; tag.style.borderRadius='6px'; tag.style.fontSize='13px'; tag.textContent = s.skill; box.appendChild(tag); }); }

// education & experience loading to left panel and viewer
async function loadViewerBio(){ try{ const { data } = await supabase.from('personal_bio').select('*').eq('id',1).single(); const [edu, exp, skills] = await Promise.all([ fetchTable('education'), fetchTable('experience'), fetchTable('skills') ]);
  el('education-viewer').innerHTML = edu.length ? edu.map(e=>`<div style='margin-bottom:8px'><strong>${e.level}</strong><div class='muted'>${e.institution} ‚Äî ${e.year}</div></div>`).join('') : '<div class="muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>';
  el('pb-detailed').innerHTML = `
    <div><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${data?.pi_fullname||''}</div>
    <div class='muted'><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</strong> ${data?.pi_dob||''} ‚Ä¢ <strong>‡πÇ‡∏ó‡∏£:</strong> ${data?.pi_phone||''}</div>
    <div style='margin-top:10px'><strong>‡∏ó‡∏±‡∏Å‡∏©‡∏∞:</strong> ${skills.map(s=>s.skill).join(', ') || '‚Äî'}</div>
  `;
  // update left quick box
  el('pb-content').innerHTML = `<div><strong>${data?.pi_fullname||''}</strong><div class='muted'>${data?.pi_address||''}</div><div class='muted'>‡πÇ‡∏ó‡∏£: ${data?.pi_phone||''}</div></div>`;
  loadSkillsAdmin();
 }catch(e){ console.warn(e); }
}

// works viewer
async function loadWorksViewer(){ const list = await fetchTable('works'); el('work-grid').innerHTML = ''; el('work-stats').textContent = `${list.length} ‡∏ä‡∏¥‡πâ‡∏ô`;
  list.forEach(w=>{ const card = document.createElement('div'); card.className='work-card'; card.innerHTML = `<div class='work-thumb'>${ w.file_url ? `<img src='${w.file_url}' style='width:100%;height:100%;object-fit:cover'/>` : '<div style="opacity:0.5">No image</div>' }</div><div class='work-title'>${w.title}</div><div class='work-meta'>${w.video_url? 'Video available' : ''}</div>`; el('work-grid').appendChild(card); }); }

// favorites
async function loadFavoritesViewer(){ const favs = await fetchTable('favorites'); el('favorites-list').innerHTML = favs.length ? favs.map(f=>`<div style='margin-bottom:8px'><strong>${f.title}</strong><div class='muted'>${f.description||''}</div></div>`).join('') : '<div class="muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>' }

// admin lists (works & favs)
async function loadWorksAdmin(){ const list = await fetchTable('works'); const root = el('work-list'); if(!root) return; root.innerHTML=''; list.forEach((w,i)=>{ const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='8px'; row.style.border='1px solid rgba(255,255,255,0.02)'; row.style.borderRadius='6px'; row.innerHTML = `<div><strong>#${i+1} ${w.title}</strong><div class='muted' style='font-size:12px'>${w.video_url? 'Video link' : ''}</div></div><div style='display:flex;gap:8px'><button class='btn-ghost edit-work' data-id='${w.id}'>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button class='btn-ghost del-work' data-id='${w.id}'>‡∏•‡∏ö</button></div>`; root.appendChild(row); });
  document.querySelectorAll('.del-work').forEach(btn=> btn.onclick = async ()=>{ await deleteTable('works', btn.getAttribute('data-id')); showPopup('‡∏•‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß'); loadWorksAdmin(); loadWorksViewer(); });
}
async function loadFavoritesAdmin(){ const list = await fetchTable('favorites'); const root = el('favorites-list-admin'); if(!root) return; root.innerHTML=''; list.forEach((f,i)=>{ const row = document.createElement('div'); row.style.padding='8px'; row.style.border='1px solid rgba(255,255,255,0.02)'; row.style.borderRadius='6px'; row.innerHTML = `<div><strong>#${i+1} ${f.title}</strong><div class='muted'>${f.description||''}</div></div><div style='text-align:right;margin-top:6px'><button class='btn-ghost del-fav' data-id='${f.id}'>‡∏•‡∏ö</button></div>`; root.appendChild(row); }); document.querySelectorAll('.del-fav').forEach(btn=> btn.onclick = async ()=>{ await deleteTable('favorites', btn.getAttribute('data-id')); showPopup('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß'); loadFavoritesAdmin(); loadFavoritesViewer(); }); }

// admin add work
el('add-work-btn')?.addEventListener('click', ()=>{
  showModal(`<div style='padding:12px'><h3 class='card-title'>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h3><input id='work-title' placeholder='‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô' class='w-full' /><input id='work-file' type='file' accept='image/*,video/*' style='margin-top:8px' /><input id='work-url' placeholder='‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠' class='w-full' style='margin-top:8px' /><div style='text-align:right;margin-top:10px'><button onclick='closeModal()' class='btn-ghost'>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button id='modal-work-save' class='btn-primary'>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></div>`);
  setTimeout(()=>{ document.getElementById('modal-card').querySelector('#modal-work-save').onclick = async ()=>{
    const title = el('work-title').value.trim(); const file = el('work-file')?.files?.[0]||null; const url = el('work-url').value.trim()||null; if(!title){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô'); return; }
    let fileUrl = null; if(file){ const path = `work_${Date.now()}_${file.name}`; const res = await supabase.storage.from('work-files').upload(path, file); if(res.error){ alert('upload failed'); console.warn(res.error); } else { const pub = await supabase.storage.from('work-files').getPublicUrl(path); fileUrl = pub?.data?.publicUrl||null; } }
    await insertTable('works', { title, file_url: fileUrl, video_url: url }); showPopup('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); closeModal(); loadWorksViewer(); loadWorksAdmin(); }
  },50);
});

// initial load
(async function init(){ await loadProfile(); await loadViewerBio(); loadWorksViewer(); loadFavoritesViewer(); loadWorksAdmin(); loadFavoritesAdmin(); })();

</script>
</body>
</html>
