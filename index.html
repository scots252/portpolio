<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <title>Creative Portfolio Dashboard (Supabase)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.27.0/dist/umd/supabase.min.js"></script>
  <style>
    body{box-sizing:border-box}
    html,body{height:100%;width:100%}
    .app-wrapper{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    .scroll-area::-webkit-scrollbar{width:8px}
    .portfolio-card{transition:transform .15s ease}
    .portfolio-card:hover{transform:translateY(-4px)}
    .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  </style>
 </head>
 <body class="w-full h-full m-0 p-0 bg-slate-950 text-slate-50">
  <div id="app" class="app-wrapper w-full h-full flex flex-col">
   <header class="w-full flex items-center justify-between px-6 py-3 border-b border-slate-800">
    <div class="flex items-center gap-3">
     <div class="w-8 h-8 rounded-full bg-sky-400 flex items-center justify-center text-slate-900 font-bold">CP</div>
     <div>
      <div class="text-sm font-semibold">Creative Portfolio</div>
      <div class="text-xs text-slate-400">Viewer / Admin (Supabase)</div>
     </div>
    </div>
    <div class="flex items-center gap-3 text-xs">
      <button id="logoutBtn" class="px-3 py-1 rounded-full bg-red-500 text-slate-900 hidden">Logout</button>
      <button id="viewerModeBtn" class="px-3 py-1 rounded-full bg-slate-100 text-slate-900">Portfolio</button>
      <button id="adminModeBtn" class="px-3 py-1 rounded-full bg-slate-900 text-slate-50">Dashboard</button>
    </div>
   </header>

<!-- Login Modal -->
<div id="loginModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
  <div class="bg-slate-900 p-6 rounded-xl w-80 shadow-xl border border-slate-700">
    <h2 class="text-lg mb-3 font-semibold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
    <input id="loginEmail" placeholder="Email" class="w-full mb-2 px-3 py-2 rounded bg-slate-800 text-xs" />
    <input id="loginPass" type="password" placeholder="Password" class="w-full mb-4 px-3 py-2 rounded bg-slate-800 text-xs" />
    <button id="loginSubmit" class="w-full px-3 py-2 bg-emerald-500 text-slate-900 rounded text-xs">Login</button>
    <button id="loginClose" class="w-full mt-2 px-3 py-2 bg-slate-700 rounded text-xs">Cancel</button>
  </div>
</div>

   <main class="flex-1 overflow-hidden flex">
    <!-- Left: Viewer -->
    <section id="viewer" class="flex-1 overflow-auto p-6 max-w-5xl mx-auto">
      <div id="hero" class="relative mb-6">
        <div id="hero-banner" class="w-full h-48 bg-gradient-to-r from-sky-500 to-fuchsia-500 rounded-lg"></div>
        <div class="-mt-16 flex items-end gap-4">
          <div class="w-28 h-28 rounded-full border-4 border-slate-950 bg-slate-800 overflow-hidden" id="avatarWrap">üé®</div>
          <div>
            <h1 id="hero-name" class="text-2xl font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô</h1>
            <p id="hero-tagline" class="text-slate-300">Tagline</p>
          </div>
        </div>
      </div>

      <nav class="mb-4">
        <button id="navWork" class="mr-2 px-3 py-1 bg-slate-800 rounded">‡∏á‡∏≤‡∏ô</button>
        <button id="navFav" class="px-3 py-1 bg-slate-800 rounded">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö</button>
      </nav>

      <div id="contentArea"></div>
    </section>

    <!-- Right: Admin -->
    <aside id="admin" class="w-[480px] bg-slate-900 border-l border-slate-800 p-6 overflow-auto hidden">
      <h2 class="text-lg mb-3">Dashboard (Supabase)</h2>

      <hr class="border-slate-800 my-4" />

      <section class="space-y-3">
        <h3 class="text-sm">Hero / Profile</h3>
        <input id="adminName" placeholder="Name" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <input id="adminTagline" placeholder="Tagline" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <input id="adminBanner" placeholder="Banner URL" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <input id="adminProfile" placeholder="Profile URL" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <div class="flex gap-2">
          <button id="saveHero" class="px-3 py-2 bg-emerald-500 rounded text-slate-900 text-xs">Save Hero</button>
          <button id="loadHero" class="px-3 py-2 bg-slate-700 rounded text-xs">Load</button>
        </div>
      </section>

      <hr class="border-slate-800 my-4" />

      <section class="space-y-3">
        <h3 class="text-sm">Works (CRUD)</h3>
        <input id="workTitle" placeholder="Title" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <input id="workCategory" placeholder="Category" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <input id="workImage" placeholder="Image URL" class="w-full px-3 py-2 rounded bg-slate-800 text-xs" />
        <textarea id="workDesc" placeholder="Description" class="w-full px-3 py-2 rounded bg-slate-800 text-xs"></textarea>
        <div class="flex gap-2">
          <button id="createWork" class="px-3 py-2 bg-sky-500 rounded text-slate-900 text-xs">Create</button>
          <button id="updateWork" class="px-3 py-2 bg-emerald-500 rounded text-slate-900 text-xs" disabled>Update</button>
          <button id="cancelWork" class="px-3 py-2 bg-slate-700 rounded text-xs">Clear</button>
        </div>
        <div id="workList" class="mt-3 space-y-2 text-xs"></div>
      </section>

      <hr class="border-slate-800 my-4" />

      <div class="text-xs text-slate-400">
    </aside>
   </main>

   <footer class="border-t border-slate-800 p-3 text-xs text-slate-400">Made with ‚ù§Ô∏è ‚Äî Supabase mode</footer>
  </div>

  <script>
    // --- Supabase integration & App logic (cleaned)
    let supabase = null;
    // default values ‚Äî you already provided these; safe to keep here for preview
    let SUPABASE_URL = "https://yrivvckaeqhfcjuputem.supabase.co";
    let SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlyaXZ2Y2thZXFoZmNqdXB1dGVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MjYzNjksImV4cCI6MjA4MDAwMjM2OX0.Hw7rtrJyXS6sClytRKSYutvW7Co5l_jmbOUOduo30u0";
    let editingWorkId = null;

    const setStatus = (t) => { const el = document.getElementById('status'); if(el) el.textContent = t || ''; };

    // UI refs (some will be null until DOM ready)
    let adminPanel, viewerBtn, adminBtn, connectBtn;

    function connectSupabase(url, key){
      try{
        supabase = window.supabase.createClient(url, key);
        return true;
      }catch(e){
        console.error('connect error', e);
        return false;
      }
    }

    // CRUD helpers
    async function createWork(data){ setStatus('creating work...'); const { data: d, error } = await supabase.from('works').insert([data]).select(); if(error){ console.error(error); setStatus('error'); alert('Create error: '+error.message); return null;} setStatus('created'); await loadWorks(); return d && d[0]; }
    async function updateWorkInDb(id, data){ setStatus('updating...'); const { data: d, error } = await supabase.from('works').update(data).eq('id', id).select(); if(error){ console.error(error); setStatus('error'); alert('Update error: '+error.message); return null;} setStatus('updated'); await loadWorks(); return d && d[0]; }
    async function deleteWorkInDb(id){ if(!confirm('‡∏•‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return; setStatus('deleting...'); const { error } = await supabase.from('works').delete().eq('id', id); if(error){ console.error(error); setStatus('error'); alert('Delete error: '+error.message); return; } setStatus('deleted'); await loadWorks(); }

    async function loadWorks(){ setStatus('loading works...'); const { data, error } = await supabase.from('works').select('*').order('created_at', {ascending:false}); if(error){ console.error(error); setStatus('error'); return; } renderWorkList(data||[]); renderWorkGrid(data||[]); setStatus('works loaded'); }

    async function saveHero(){ const name = document.getElementById('adminName').value.trim(); const tagline = document.getElementById('adminTagline').value.trim(); const banner = document.getElementById('adminBanner').value.trim(); const profile = document.getElementById('adminProfile').value.trim(); setStatus('saving hero...'); const payload = { id: 1, name, tagline, banner_url: banner, profile_url: profile }; const { data, error } = await supabase.from('config_main').upsert(payload).select(); if(error){ console.error(error); setStatus('error'); alert('Save hero error: '+error.message); return; } await loadHero(); setStatus('hero saved'); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }

    async function loadHero(){ const res = await supabase.from('config_main').select('*').eq('id',1).limit(1).maybeSingle(); if(res.error){ console.warn(res.error); } const data = res.data; if(data){ document.getElementById('hero-name').textContent = data.name || '‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô'; document.getElementById('hero-tagline').textContent = data.tagline || ''; if(data.banner_url) document.getElementById('hero-banner').style.backgroundImage = `url('${data.banner_url}')`; if(data.profile_url) document.getElementById('avatarWrap').innerHTML = `<img src="${data.profile_url}" class="w-full h-full object-cover"/>`; document.getElementById('adminName').value = data.name||''; document.getElementById('adminTagline').value = data.tagline||''; document.getElementById('adminBanner').value = data.banner_url||''; document.getElementById('adminProfile').value = data.profile_url||''; } }

    function clearWorkForm(){ document.getElementById('workTitle').value=''; document.getElementById('workCategory').value=''; document.getElementById('workImage').value=''; document.getElementById('workDesc').value=''; editingWorkId = null; document.getElementById('updateWork').disabled = true; }

    function renderWorkList(items){ const el = document.getElementById('workList'); el.innerHTML=''; items.forEach(it=>{ const row = document.createElement('div'); row.className='flex items-center justify-between p-2 bg-slate-800 rounded'; row.innerHTML = `<div class="min-w-0"><div class="text-sm">${escapeHtml(it.title||'')}</div><div class="text-xs text-slate-400">${escapeHtml(it.category||'')}</div></div><div class="flex gap-2"><button data-id="${it.id}" class="editBtn px-2 py-1 bg-slate-100 text-slate-900 text-xs rounded">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button data-id="${it.id}" class="delBtn px-2 py-1 bg-slate-700 text-xs rounded">‡∏•‡∏ö</button></div>`; el.appendChild(row); }); Array.from(el.querySelectorAll('.editBtn')).forEach(b=>b.onclick=()=>onEditWork(b.dataset.id, items.find(x=>x.id==b.dataset.id))); Array.from(el.querySelectorAll('.delBtn')).forEach(b=>b.onclick=()=>deleteWorkInDb(b.dataset.id)); }

    function onEditWork(id, data){ editingWorkId = id; document.getElementById('workTitle').value = data.title||''; document.getElementById('workCategory').value = data.category||''; document.getElementById('workImage').value = data.image_url||''; document.getElementById('workDesc').value = data.description||''; document.getElementById('updateWork').disabled=false; }

    function renderWorkGrid(items){ const grid = document.getElementById('contentArea'); const html = ['<div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">']; items.forEach(it=>{ html.push(`<article class="bg-slate-900 p-3 rounded-lg"><div class="w-full h-44 bg-slate-800 overflow-hidden mb-2">${it.image_url?`<img src='${escapeAttr(it.image_url)}' class='w-full h-full object-cover'/>`:'<div class="w-full h-full flex items-center justify-center text-slate-500">No image</div>'}</div><h4 class="font-semibold">${escapeHtml(it.title||'')}</h4><p class="text-xs text-slate-400">${escapeHtml(it.category||'')}</p><p class="text-xs text-slate-300 mt-2 line-clamp-2">${escapeHtml(it.description||'')}</p></article>`); }); html.push('</div>'); grid.innerHTML = html.join(''); }

    // Utils
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
    function escapeAttr(s){ return String(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

    async function loadAll(){ if(!supabase){ setStatus('no supabase'); return; } await loadHero(); await loadWorks(); }

    // DOM ready init
    document.addEventListener('DOMContentLoaded', async ()=>{
      adminPanel = document.getElementById('admin'); viewerBtn = document.getElementById('viewerModeBtn'); adminBtn = document.getElementById('adminModeBtn'); // connectBtn removed

      // removed credentials populate
      connectSupabase(SUPABASE_URL, SUPABASE_KEY); setStatus('connected');
      await loadAll();

      // Handlers
      // removed credentials UI').addEventListener('click', ()=>{ localStorage.removeItem('SUPABASE_URL'); localStorage.removeItem('SUPABASE_KEY'); document.getElementById('supabaseUrl').value=''; document.getElementById('supabaseKey').value=''; setStatus('credentials cleared'); });
      // auto connect handled below);

      // auth - show login modal when admin requested and not logged in
      logoutBtn = document.getElementById('logoutBtn');

      adminBtn.addEventListener('click', async ()=>{
        if(!supabase){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase'); return; }
        const { data: userData, error } = await supabase.auth.getUser();
        const user = userData && userData.user ? userData.user : null;
        if(!user){ document.getElementById('loginModal').classList.remove('hidden'); return; }
        adminPanel.classList.remove('hidden'); document.getElementById('viewer').classList.add('hidden'); logoutBtn.classList.remove('hidden');
      });

      viewerBtn.addEventListener('click', ()=>{ adminPanel.classList.add('hidden'); document.getElementById('viewer').classList.remove('hidden'); });

      // login modal handlers
      logoutBtn.addEventListener('click', async ()=>{
        await supabase.auth.signOut();
        adminPanel.classList.add('hidden');
        logoutBtn.classList.add('hidden');
        alert('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
      });

      document.getElementById('loginSubmit').addEventListener('click', async ()=>{
        const email = document.getElementById('loginEmail').value.trim();
        const pass = document.getElementById('loginPass').value.trim();
        if(!email || !pass) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÅ‡∏•‡∏∞ Password');
        const { data, error } = await supabase.auth.signInWithPassword({ email, password: pass });
        if(error){ alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+error.message); return; }
        document.getElementById('loginModal').classList.add('hidden'); adminPanel.classList.remove('hidden'); await loadAll();
      });
      document.getElementById('loginClose').addEventListener('click', ()=>document.getElementById('loginModal').classList.add('hidden'));

      // admin hero buttons
      document.getElementById('saveHero').addEventListener('click', async ()=>{ if(!supabase) return alert('‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase'); await saveHero(); });
      document.getElementById('loadHero').addEventListener('click', async ()=>{ if(!supabase) return alert('‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase'); await loadHero(); });

      // works form
      document.getElementById('createWork').addEventListener('click', async ()=>{ if(!supabase) return alert('‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase'); const title = document.getElementById('workTitle').value.trim(); const category = document.getElementById('workCategory').value.trim(); const image_url = document.getElementById('workImage').value.trim(); const description = document.getElementById('workDesc').value.trim(); if(!title) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô'); await createWork({title, category, image_url, description}); clearWorkForm(); });
      document.getElementById('updateWork').addEventListener('click', async ()=>{ if(!supabase) return alert('‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase'); if(!editingWorkId) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç'); const title = document.getElementById('workTitle').value.trim(); const category = document.getElementById('workCategory').value.trim(); const image_url = document.getElementById('workImage').value.trim(); const description = document.getElementById('workDesc').value.trim(); await updateWorkInDb(editingWorkId,{title, category, image_url, description}); clearWorkForm(); });
      document.getElementById('cancelWork').addEventListener('click', ()=>clearWorkForm());

      // nav
      document.getElementById('navWork').addEventListener('click', async ()=>{ if(!supabase) return alert('Not connected'); await loadWorks(); });
      document.getElementById('navFav').addEventListener('click', ()=>{ document.getElementById('contentArea').innerHTML='<p class="text-slate-400">Favorites viewer - implement similarly to works.</p>'; });

    });

    // IMPORTANT: Database schema expected (create these tables in Supabase):
    // Table: config_main (id int primary key, name text, tagline text, banner_url text, profile_url text, created_at timestamptz default now())
    // Table: works (id serial primary key, title text, category text, image_url text, description text, created_at timestamptz default now())

    // If you want, I can create SQL migration statements for these tables ‚Äî tell me and I'll add them here.
  </script>
 </body>
</html>
