<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <title>Creative Portfolio Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Supabase JS Client (v2) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
  // --- Supabase Client Init ---
  const supabaseUrl = "https://yrivvckaeqhfcjuputem.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlyaXZ2Y2thZXFoZmNqdXB1dGVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MjYzNjksImV4cCI6MjA4MDAwMjM2OX0.Hw7rtrJyXS6sClytRKSYutvW7Co5l_jmbOUOduo30u0";
  const supabase = window.supabase?.createClient?.(supabaseUrl, supabaseKey, { auth: { persistSession: false } });

  try {
    Object.keys(localStorage).forEach((k) => {
      if (k.toLowerCase().includes('supabase') || k.toLowerCase().includes('sb-')) {
        localStorage.removeItem(k);
      }
    });
  } catch (e) {
    console.warn('Could not clear supabase-related localStorage keys', e);
  }
  </script>
  <style>
      body { box-sizing: border-box; }
      html, body { height: 100%; width: 100%; }
      .app-wrapper { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
      .scroll-area::-webkit-scrollbar { width: 8px; }
      .scroll-area::-webkit-scrollbar-track { background: transparent; }
      .scroll-area::-webkit-scrollbar-thumb { border-radius: 999px; }
      .focus-ring:focus-visible { outline: 2px solid rgba(255, 255, 255, 0.8); outline-offset: 2px; }
      .focus-ring-dark:focus-visible { outline: 2px solid rgba(0, 0, 0, 0.8); outline-offset: 2px; }
      .portfolio-card { transition: transform 150ms ease, box-shadow 150ms ease; }
      .portfolio-card:hover { transform: translateY(-4px); }
      .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
      .skill-chip { padding:6px 10px; border-radius:999px; background:#1f2937; color:#fff; display:inline-flex; gap:8px; align-items:center; }
      .skill-chip button{ background:#ef4444; color:white; border:none; padding:2px 6px; border-radius:6px; cursor:pointer; }
    </style>
<style>
.fadeOut { opacity:0; transform:scale(0.8); transition:all .25s ease; }
.fadeIn { opacity:1; transform:scale(1); transition:all .25s ease; }
.popup-msg { position:fixed; top:20px; right:20px; background:#10b981; color:#000; padding:10px 16px; border-radius:8px; z-index:9999; }
</style>
 </head>
 <body class="w-full h-full m-0 p-0">
  <div id="app" class="app-wrapper w-full h-full bg-slate-950 text-slate-50 flex flex-col">
   <header class="w-full flex items-center justify-between px-6 py-3 border-b border-slate-800 bg-slate-950/90">
    <div class="flex items-center gap-2">
     <div class="w-7 h-7 rounded-full bg-sky-400 flex items-center justify-center text-slate-950 font-semibold text-xs">CP</div>
     <div class="flex flex-col leading-tight"><span id="panel-brand" class="text-sm font-semibold tracking-wide"> Creative Portfolio </span> <span class="text-[11px] text-slate-400"> Viewer / Admin dashboard </span></div>
    </div>
    <div id="header-actions" class="flex items-center gap-2 text-[11px]"><span class="text-slate-400">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á:</span> <button id="viewerModeBtn" type="button" class="focus-ring-dark px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-900 border border-slate-300"> Portfolio </button> <button id="adminModeBtn" type="button" class="focus-ring px-3 py-1 rounded-full text-xs font-medium bg-slate-900 text-slate-100 border border-slate-700"> Dashboard </button></div>
   </header>
   <main id="main-content" class="flex-1 w-full overflow-hidden flex flex-col">
    <section id="viewer-section" class="h-full w-full overflow-hidden flex flex-col" aria-label="Portfolio viewer">
     <section class="relative w-full" aria-labelledby="hero-title">
      <div id="hero-banner" class="w-full h-[220px] bg-gradient-to-r from-sky-500 via-fuchsia-500 to-amber-400"></div>
      <div class="max-w-5xl mx-auto px-6 -mt-16 relative z-10 flex gap-6 items-end">
       <div class="shrink-0 w-28 h-28 rounded-full border-4 border-slate-950 bg-slate-800 flex items-center justify-center overflow-hidden">
        <div id="profile-avatar-fallback" class="w-full h-full flex items-center justify-center text-3xl" aria-hidden="true">üé®</div>
        <img id="profile-avatar-img" src="" alt="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô" class="w-full h-full object-cover rounded-full" onerror="this.style.display='none'; document.getElementById('profile-avatar-fallback').style.display='flex';">
       </div>
       <div class="flex-1 pb-4">
        <h1 id="hero-title" class="text-2xl md:text-3xl font-semibold tracking-tight mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô ‚Äì Designer / Illustrator / Videographer</h1>
        <p id="hero-tagline" class="text-sm md:text-base text-slate-300 max-w-2xl">‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å &amp; ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå &amp; ‡∏ñ‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ &amp; ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå &amp; ‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
        <div class="mt-4 flex flex-wrap items-center gap-3"><a id="facebook-link" href="#" target="_blank" rel="noopener noreferrer" class="focus-ring inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-slate-500/60 bg-slate-900/70 text-xs md:text-sm text-slate-50 hover:bg-slate-800/80 transition-colors"> <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-sky-500 text-[11px] font-bold text-slate-950" aria-hidden="true"> f </span> <span>Facebook Portfolio</span> </a> <span id="work-overview-text" class="text-[11px] md:text-xs text-slate-400"> Portfolio ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‚Äì Graphic / Video / Illustration </span></div>
       </div>
      </div>
      <nav class="w-full border-b border-slate-800 mt-6" aria-label="Portfolio sections">
       <div class="max-w-5xl mx-auto px-6 flex gap-6 text-sm">
         <button id="nav-1" type="button" class="focus-ring pb-3 border-b-2 border-sky-400 text-slate-50 font-medium"> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß </button>
         <button id="nav-work" type="button" class="focus-ring pb-3 border-b-2 border-transparent text-slate-400 hover:text-slate-100"> ‡∏ú‡∏•‡∏á‡∏≤‡∏ô </button>
         <button id="nav-favorites" type="button" class="focus-ring pb-3 border-b-2 border-transparent text-slate-400 hover:text-slate-100"> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö </button></div>
      </nav>
     </section>
     <section class="flex-1 w-full overflow-y-auto scroll-area">
      <div class="max-w-5xl mx-auto px-6 py-6 space-y-10">
       <section id="personal-bio-view" class="hidden" aria-labelledby="pb-title">
  <h2 id="pb-title" class="text-lg md:text-xl font-semibold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
  <div id="pb-content" class="space-y-6 text-sm text-slate-300"></div>
</section>

<section id="work-section" aria-labelledby="work-section-title">
  <div class="flex items-baseline justify-between mb-4">
    <h2 id="work-section-title" class="text-lg md:text-xl font-semibold">Selected Works</h2>
    <p id="work-stats" class="text-xs text-slate-400">‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 0 ‡∏ä‡∏¥‡πâ‡∏ô</p>
  </div>
  <div id="work-grid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
</section>
       <section id="favorites-section" class="hidden" aria-labelledby="favorites-section-title">
        <div class="flex items-baseline justify-between mb-4">
         <h2 id="favorites-section-title" class="text-lg md:text-xl font-semibold">Inspirations &amp; Favorites</h2>
         <p id="favorites-stats" class="text-xs text-slate-400">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
        </div>
        <div id="favorites-list" class="grid gap-4 md:grid-cols-2"></div>
       </section>
       <section aria-label="Experience and skills" class="border-t border-slate-800 pt-6 space-y-8">
        <div class="grid gap-8 md:grid-cols-3"><div class="md:col-span-2"><h3 id="experience-title" class="text-base md:text-lg font-semibold mb-3">Experience</h3><div id="experience-list" class="space-y-4"></div><p id="experience-empty" class="text-xs text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ</p></div>
       </section>
      </div>
     </section>
    </section>
    <section id="admin-section" class="hidden w-full h-full overflow-y-auto bg-slate-900 p-6 text-slate-100">
     <h1 class="text-2xl font-semibold mt-0 mb-4">Dashboard ‚Äì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h1>


<!-- Quick Menu -->
<div class="flex gap-3 mb-6 text-sm">
  <button id="menu-profile-settings" class="px-4 py-2 rounded bg-slate-800 border border-slate-700 hover:bg-slate-700">1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
  <button id="menu-personal-bio" class="px-4 py-2 rounded bg-slate-800 border border-slate-700 hover:bg-slate-700">2. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</button>
  <button id="menu-work-manage" onclick="document.getElementById('profile-settings').classList.add('hidden');document.getElementById('personal-bio-admin').classList.add('hidden');document.getElementById('work-manage').classList.remove('hidden');" class="px-4 py-2 rounded bg-slate-800 border border-slate-700 hover:bg-slate-700">3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
</div>


<!-- ===== Profile Settings ===== -->

<!-- ===== Work Manage (Upload Works) ===== -->
<div id="work-manage" class="hidden mt-6 bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-lg">
  <h2 class="text-lg font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h2>
  <div class="space-y-3">
    <label class="text-sm">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô</label>
    <input id="work-title" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
    <label class="text-sm">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label>
    <input id="work-link" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
    <label class="text-sm">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label>
    <input id="work-file" type="file" accept="image/*,video/*" class="w-full text-sm" />
    <button id="save-work-btn" class="w-full mt-2 px-4 py-2 bg-emerald-400 text-black rounded font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
  </div>
  <h3 class="text-md font-semibold mt-6 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h3>
  <div id="work-list" class="space-y-2"></div>
</div>
<div id="profile-settings">
<div class="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-lg space-y-3">
 <h2 class="text-lg font-semibold">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h2>
 <label class="text-sm">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)</label>
 <input id="banner-upload" type="file" accept="image/*" class="w-full text-sm" />
 <label class="text-sm">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)</label>
 <input id="avatar-upload" type="file" accept="image/*" class="w-full text-sm" />
 <label class="text-sm">‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô</label>
 <input id="artist-name" type="text" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
 <label class="text-sm">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ï‡πâ‡∏ä‡∏∑‡πà‡∏≠</label>
 <textarea id="artist-bio" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700"></textarea>
 <label class="text-sm">‡∏•‡∏¥‡∏á‡∏Å‡πå Facebook</label>
 <input id="artist-facebook" type="text" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
 <button id="save-profile-btn" class="w-full mt-2 px-4 py-2 bg-emerald-400 text-black rounded font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

</div>

<!-- ===== Personal Bio Tab (ADMIN) ===== -->
<div id="personal-bio-admin" class="hidden mt-6 bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-lg">
  <h2 class="text-lg font-semibold mb-3">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (Personal Bio)</h2>
  <!-- Personal Information -->
  <div class="bg-slate-900 p-4 rounded mb-4">
    <h3 class="font-semibold mb-2">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personal Information)</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <input id="pi_fullname" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="px-3 py-2 rounded bg-slate-800 border border-slate-700" />
      <input id="pi_dob" type="date" placeholder="‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î" class="px-3 py-2 rounded bg-slate-800 border border-slate-700" />
      <input id="pi_address" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô" class="col-span-1 md:col-span-2 px-3 py-2 rounded bg-slate-800 border border-slate-700" />
      <input id="pi_phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="px-3 py-2 rounded bg-slate-800 border border-slate-700" />
      <input id="pi_email" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" class="px-3 py-2 rounded bg-slate-800 border border-slate-700" />
      <input id="pi_status" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û (‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏™‡∏î/‡∏™‡∏°‡∏£‡∏™)" class="px-3 py-2 rounded bg-slate-800 border border-slate-700" />
      <input id="pi_nationality" placeholder="‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥/‡∏®‡∏≤‡∏™‡∏ô‡∏≤" class="px-3 py-2 rounded bg-slate-800 border border-slate-700" />
    </div>
    <div class="pt-3"><button id="save-personal-info" class="px-4 py-2 bg-emerald-400 text-black rounded font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</button></div>
  </div>

  <!-- Education -->

<!-- === MODAL: Education Form === -->
<div id="edu-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-slate-800 w-full max-w-md p-6 rounded-xl border border-slate-700 shadow-xl">
    <h3 id="edu-modal-title" class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
    <div class="space-y-3">
      <input id="edu-level" placeholder="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <input id="edu-inst" placeholder="‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <input id="edu-major" placeholder="‡∏™‡∏≤‡∏Ç‡∏≤" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <input id="edu-year" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <input id="edu-gpa" placeholder="GPA" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
    </div>
    <div class="flex justify-end gap-2 mt-5">
      <button id="edu-cancel" class="px-4 py-2 bg-slate-700 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button id="edu-save" class="px-4 py-2 bg-emerald-400 text-black rounded font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>
  <div class="bg-slate-900 p-4 rounded mb-4">
    <h3 class="font-semibold mb-2">2. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
    <p class="text-xs text-slate-400 mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
    <div class="flex gap-2 mb-3">
      <button id="add-education-btn" class="px-3 py-1 bg-sky-500 rounded text-black text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
      <button id="clear-education-btn" class="px-3 py-1 bg-rose-600 rounded text-white text-sm">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
    <div id="education-list" class="space-y-2"></div>
  </div>

  <!-- Experience Modal -->
<div id="exp-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-slate-800 w-full max-w-md p-6 rounded-xl border border-slate-700 shadow-xl">
    <h3 id="exp-modal-title" class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</h3>
    <div class="space-y-3">
      <input id="exp-company" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <input id="exp-position" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <input id="exp-period" placeholder="‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô 2020-2023)" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700" />
      <textarea id="exp-resp" placeholder="‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö" class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-700"></textarea>
    </div>
    <div class="flex justify-end gap-2 mt-5">
      <button id="exp-cancel" class="px-4 py-2 bg-slate-700 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button id="exp-save" class="px-4 py-2 bg-emerald-400 text-black rounded font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<!-- Experience -->
  <div class="bg-slate-900 p-4 rounded mb-4">
    <h3 class="font-semibold mb-2">3. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</h3>
    <p class="text-xs text-slate-400 mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</p>
    <div class="flex gap-2 mb-3">
      <button id="add-experience-btn" class="px-3 py-1 bg-sky-500 rounded text-black text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</button>
      <button id="clear-experience-btn" class="px-3 py-1 bg-rose-600 rounded text-white text-sm">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
    <div id="experience-list-admin" class="space-y-2"></div>
  </div>

  <!-- Skills -->
  <div class="bg-slate-900 p-4 rounded mb-4">
    <h3 class="font-semibold mb-2">4. ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ</h3>
    <p class="text-xs text-slate-400 mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö ‡∏ó‡∏±‡∏Å‡∏©‡∏∞</p>
    <div class="flex gap-2 mb-3">
      <input id="skill-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Enter" class="px-3 py-2 rounded bg-slate-800 border border-slate-700 flex-1" />
      <button id="add-skill-btn" class="px-3 py-2 bg-sky-500 rounded text-black">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
     
    </div>
    <div id="skills-list" class="mt-3 flex flex-wrap gap-2"></div>
  </div>
  <script>
// === WORK MANAGEMENT (FULL WORKING V2) ===
async function renderWorkList(){
  const box=document.getElementById('work-list'); if(!box) return;
  box.innerHTML='<div class="text-xs text-slate-400">Loading...</div>';
  const { data, error } = await supabase.from('works').select('*').eq('user_id',1).order('id',{ascending:false});
  if(error){ box.innerHTML='<div class="text-red-400 text-xs">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</div>'; return; }
  if(!data || !data.length){ box.innerHTML='<div class="text-slate-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏á‡∏≤‡∏ô</div>'; return; }
  box.innerHTML='';
  data.forEach(item=>{
    const el=document.createElement('div'); el.className='p-3 bg-slate-800 rounded flex justify-between items-center';
    el.innerHTML=`<div><div class='font-semibold text-slate-100'>${escapeHtml(item.title)}</div><div class='text-xs text-slate-400 break-all'>${escapeHtml(item.media_url||'')}</div></div><button class='del-work px-2 py-1 text-xs bg-rose-600 rounded'>‡∏•‡∏ö</button>`;
    box.appendChild(el);
    el.querySelector('.del-work').onclick=async()=>{ await supabase.from('works').delete().eq('id',item.id); renderWorkList(); };
  });
}
async function saveWork(){
  const title=document.getElementById('work-title').value.trim();
  const link=document.getElementById('work-link').value.trim();
  const file=document.getElementById('work-file').files[0];
  if(!title){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô'); return; }
  let mediaUrl='';
  if(link) mediaUrl=link;
  if(file) mediaUrl=await uploadFile('work-media',file);
  const { error } = await supabase.from('works').insert({title,media_url:mediaUrl,user_id:1});
  if(error){ alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'); return; }
  document.getElementById('work-title').value='';
  document.getElementById('work-link').value='';
  document.getElementById('work-file').value='';
  const p=document.createElement('div'); p.className='fixed top-5 right-5 bg-emerald-500 text-black px-4 py-2 rounded shadow-xl'; p.innerText='‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'; document.body.appendChild(p); setTimeout(()=>p.remove(),2000);
  renderWorkList();
}
document.getElementById('save-work-btn')?.addEventListener('click', saveWork);
renderWorkList();
</script>
</body>
</html>

<script>
// Constants
const USER_ID = 1; // fixed owner id for this demo
const STORAGE_KEYS = { profile: 'cp_profile' };
const piFields = ['pi_fullname','pi_dob','pi_address','pi_phone','pi_email','pi_status','pi_nationality'];

function escapeHtml(s){ if(s===0) return '0'; if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// ---------- Personal info (existing) ----------
async function loadPersonalInfo(){
  if (supabase) {
    try {
      const { data, error } = await supabase.from('personal_bio').select('*').eq('id',1).single();
      if(!error && data) {
        piFields.forEach(id => {
          const el = document.getElementById(id);
          if(!el) return;
          el.value = data[id] || '';
        });
        return;
      }
    } catch(e) { console.warn('Supabase load personal info failed', e); }
  }
  // fallback local
  const p = JSON.parse(localStorage.getItem(STORAGE_KEYS.profile) || '{}');
  const personal = p.personal || {};
  piFields.forEach(id => { const el = document.getElementById(id); if(!el) return; el.value = personal[id] || ''; });
}

async function savePersonalInfoToServer(){
  const payload = { id:1 };
  piFields.forEach(id => { const el = document.getElementById(id); if(!el) return; payload[id] = el.value || ''; });
  if(!supabase) { alert('Supabase not available'); return; }
  try{
    const { error } = await supabase.from('personal_bio').upsert(payload);
    if(error) { throw error; }
    // Popup ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    const popup = document.createElement('div');
    popup.className = 'fixed top-5 right-5 bg-emerald-500 text-black px-4 py-2 rounded shadow-xl animate-pulse z-50';
    popup.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
    document.body.appendChild(popup);
    setTimeout(()=>popup.remove(),2000);
    await loadPersonalInfo();
  }catch(e){ console.error(e); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+(e.message||e)); }
}

// ---------- CRUD helpers for Supabase tables ----------
async function fetchTable(table){
  if(!supabase) return [];
  try{
    const { data, error } = await supabase.from(table).select('*').eq('user_id', USER_ID).order('id', { ascending: false });
    if(error) throw error;
    return data || [];
  }catch(e){ console.warn('fetchTable', table, e); return []; }
}

async function insertTable(table, record){
  if(!supabase) return null;
  try{
    const { data, error } = await supabase.from(table).insert([{ ...record, user_id: USER_ID }]).select();
    if(error) throw error;
    return (data && data[0]) || null;
  }catch(e){ console.error('insertTable', table, e); return null; }
}

async function updateTableById(table, id, changes){
  if(!supabase) return null;
  try{
    const { data, error } = await supabase.from(table).update(changes).eq('id', id).eq('user_id', USER_ID).select();
    if(error) throw error;
    return (data && data[0]) || null;
  }catch(e){ console.error('updateTableById', table, e); return null; }
}

async function deleteTableById(table, id){
  if(!supabase) return false;
  try{
    const { error } = await supabase.from(table).delete().eq('id', id).eq('user_id', USER_ID);
    if(error) throw error;
    return true;
  }catch(e){ console.error('deleteTableById', table, e); return false; }
}

async function deleteAllFromTable(table){
  if(!supabase) return false;
  try{
    const { error } = await supabase.from(table).delete().eq('user_id', USER_ID);
    if(error) throw error;
    return true;
  }catch(e){ console.error('deleteAllFromTable', table, e); return false; }
}

// ---------- Education ----------
async function renderEducation(){
  const container = document.getElementById('education-list'); if(!container) return;
  container.innerHTML = '<div class="text-xs text-slate-400">Loading...</div>';
  let list = await fetchTable('education'); list = list.sort((a,b)=> (parseInt(a.year)||0) - (parseInt(b.year)||0));
  container.innerHTML = '';
  if(!list.length) { container.innerHTML = '<div class="text-slate-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>'; return; }
  list.forEach(item => {
    const el = document.createElement('div'); el.className='p-3 bg-slate-800 rounded border border-slate-700 flex items-start justify-between';
    el.innerHTML = `<div><div class="font-semibold">${escapeHtml(item.level||'')} ‚Äî ${escapeHtml(item.institution||'')}</div><div class="text-xs text-slate-400">‡∏™‡∏≤‡∏Ç‡∏≤: ${escapeHtml(item.major||'')} | ‡∏õ‡∏µ: ${escapeHtml(item.year||'')} | GPA: ${escapeHtml(item.gpa||'')}</div></div><div class="flex gap-2"><button class="edit-edu px-2 py-1 text-xs rounded bg-amber-400 text-black">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button class="del-edu px-2 py-1 text-xs rounded bg-rose-600 text-white">‡∏•‡∏ö</button></div>`;
    container.appendChild(el);
    // attach listeners
    el.querySelector('.edit-edu').addEventListener('click', ()=> openEduModal(true, item));
    el.querySelector('.del-edu').addEventListener('click', async ()=>{ if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { const ok = await deleteTableById('education', item.id); if(ok) renderEducation(); else alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } });
  });
}

async function promptEditEducation(item){
  // kept for backward compatibility but now opens modal
  openEduModal(true, item);
}

let eduEditingId = null;

function openEduModal(edit=false, item={}) {
  const modal = document.getElementById('edu-modal');
  if(!modal) return;
  document.getElementById('edu-modal-title').innerText = edit ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤';
  eduEditingId = edit ? item.id : null;
  document.getElementById('edu-level').value = item.level || '';
  document.getElementById('edu-inst').value = item.institution || '';
  document.getElementById('edu-major').value = item.major || '';
  document.getElementById('edu-year').value = item.year || '';
  document.getElementById('edu-gpa').value = item.gpa || '';
  modal.classList.remove('hidden');
}
function closeEduModal(){ const modal = document.getElementById('edu-modal'); if(modal) modal.classList.add('hidden'); }

// handlers will be attached inside DOMContentLoaded for safety

async function addEducation(){ openEduModal(false); }

async function clearEducation(){ if(!confirm('‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return; const ok = await deleteAllFromTable('education'); if(ok) renderEducation(); else alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }

// ---------- Experience ----------
let expEditingId = null;
function openExpModal(edit=false, item={}){
  const m=document.getElementById('exp-modal'); if(!m) return;
  document.getElementById('exp-modal-title').innerText = edit? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå':'‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå';
  expEditingId = edit? item.id:null;
  document.getElementById('exp-company').value=item.company||'';
  document.getElementById('exp-position').value=item.position||'';
  document.getElementById('exp-period').value=item.period||'';
  document.getElementById('exp-resp').value=item.responsibilities||'';
  m.classList.remove('hidden');
}
function closeExpModal(){ document.getElementById('exp-modal')?.classList.add('hidden'); }
async function renderExperience(){
  const container=document.getElementById('experience-list-admin'); if(!container) return;
  container.innerHTML='<div class="text-xs text-slate-400">Loading...</div>';
  let list=await fetchTable('experience');
  // SORT: old years first (ascending)
  list = list.sort((a,b)=>{
    const ay = parseInt((a.period||'').split('-')[0])||0;
    const by = parseInt((b.period||'').split('-')[0])||0;
    return ay - by;
  });
  container.innerHTML='';
  if(!list.length){ container.innerHTML='<div class="text-slate-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>'; return; }
  list.forEach(item=>{
    const el=document.createElement('div'); el.className='p-3 bg-slate-800 rounded border border-slate-700 flex items-start justify-between';
    el.innerHTML=`<div><div class="font-semibold">${escapeHtml(item.company||'')} ‚Äî ${escapeHtml(item.position||'')}</div><div class="text-xs text-slate-400">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${escapeHtml(item.period||'')}</div><div class="text-sm text-slate-300 mt-2">${escapeHtml(item.responsibilities||'')}</div></div><div class="flex gap-2"><button class="edit-exp px-2 py-1 text-xs rounded bg-amber-400 text-black">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button class="del-exp px-2 py-1 text-xs rounded bg-rose-600 text-white">‡∏•‡∏ö</button></div>`;
    container.appendChild(el);
    el.querySelector('.edit-exp').onclick=()=>openExpModal(true,item);
    el.querySelector('.del-exp').onclick=async()=>{ if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')){ const ok=await deleteTableById('experience',item.id); if(ok) renderExperience(); else alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } };
  });
}
async function addExperience(){ openExpModal(false); }
async function clearExperience(){ if(!confirm('‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return; const ok=await deleteAllFromTable('experience'); if(ok) renderExperience(); else alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }

// ---------- Skills ----------
function showPopup(msg){
  const p = document.createElement('div');
  p.className='popup-msg';
  p.textContent=msg;
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),2000);
}
let skillBuffer = [];
async function loadSkills(){
  skillBuffer = await fetchTable('skills');
  renderSkills();
}
function renderSkills(){
  const container = document.getElementById('skills-list'); if(!container) return;
  container.innerHTML = '';
  if(!skillBuffer.length){ container.innerHTML='<div class="text-slate-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏±‡∏Å‡∏©‡∏∞</div>'; return; }
  skillBuffer.forEach((item,idx)=>{
    const chip=document.createElement('div');
    chip.className='skill-chip fadeIn';
    chip.innerHTML=`<span>${escapeHtml(item.skill)}</span>`;
    const del=document.createElement('button'); del.textContent='x'; del.dataset.index=idx;
    del.onclick=()=>animateRemoveSkill(idx);
    chip.appendChild(del);
    container.appendChild(chip);
  });
}
function animateRemoveSkill(idx){
  const item = skillBuffer[idx];
  if(!item) return;
  const container=document.getElementById('skills-list');
  const chip=container.children[idx]; if(!chip) return;
  chip.classList.add('fadeOut');
  setTimeout(async()=>{
    await deleteTableById('skills', item.id);
    await loadSkills();
    showPopup('‡∏•‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
  },250);
}
async function addSkillFromInput(){
  const input=document.getElementById('skill-input'); if(!input) return;
  const v=input.value.trim(); if(!v) return;
  await insertTable('skills',{ skill:v });
  await loadSkills(); input.value='';
}
async function clearSkills(){
  if(!confirm('‡∏•‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
  const ok = await deleteAllFromTable('skills');
  if(ok){ await loadSkills(); showPopup('‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); }
}
// ---------- Misc ----------
async function renderMisc(){
  const container = document.getElementById('misc-list'); if(!container) return;
  container.innerHTML = '';
  const list = await fetchTable('misc');
  if(!list.length) { container.innerHTML = '<div class="text-slate-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏°</div>'; return; }
  list.forEach(item => {
    const el = document.createElement('div'); el.className='p-3 bg-slate-800 rounded border border-slate-700 flex items-start justify-between';
    el.innerHTML = `<div><div class="font-semibold">${escapeHtml(item.title||'')}</div><div class="text-xs text-slate-400">${escapeHtml(item.detail||'')}</div></div><div class="flex gap-2"><button class="edit-misc px-2 py-1 text-xs rounded bg-amber-400 text-black">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button class="del-misc px-2 py-1 text-xs rounded bg-rose-600 text-white">‡∏•‡∏ö</button></div>`;
    container.appendChild(el);
    el.querySelector('.edit-misc').addEventListener('click', ()=>promptEditMisc(item));
    el.querySelector('.del-misc').addEventListener('click', async ()=>{ if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { const ok = await deleteTableById('misc', item.id); if(ok) renderMisc(); else alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } });
  });
}
async function promptEditMisc(item){
  const title = prompt('‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:', item.title); if(title===null) return;
  const detail = prompt('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:', item.detail); if(detail===null) return;
  const updated = await updateTableById('misc', item.id, { title, detail });
  if(updated) renderMisc(); else alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
}
async function addMisc(){ const title = prompt('‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£):'); if(title===null) return; const detail = prompt('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:'); if(detail===null) return; const rec = await insertTable('misc', { title, detail }); if(rec) renderMisc(); else alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
async function clearMisc(){ if(!confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return; const ok = await deleteAllFromTable('misc'); if(ok) renderMisc(); else alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }

// ---------- Load viewer bio (reads from supabase tables) ----------
async function loadViewerBio(){
  // personal
  let personal = {};
  try{
    const { data } = await supabase.from('personal_bio').select('*').eq('id',1).single();
    personal = data || {};
  }catch(e){ console.warn('loadViewerBio personal', e); }

  // other lists
  const [edu, exp, skills, misc] = await Promise.all([
    fetchTable('education'),
    fetchTable('experience'),
    fetchTable('skills'),
    fetchTable('misc')
  ]);

  const box = document.getElementById('pb-content');
  box.innerHTML = `
    <div>
      <h3 class="font-semibold text-base mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
      <p>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: ${escapeHtml(personal['pi_fullname']||'')}</p>
      <p>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î: ${escapeHtml(personal['pi_dob']||'')}</p>
      <p>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${escapeHtml(personal['pi_address']||'')}</p>
      <p>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${escapeHtml(personal['pi_phone']||'')}</p>
      <p>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${escapeHtml(personal['pi_email']||'')}</p>
      <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û: ${escapeHtml(personal['pi_status']||'')}</p>
      <p>‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥/‡∏®‡∏≤‡∏™‡∏ô‡∏≤: ${escapeHtml(personal['pi_nationality']||'')}</p>
    </div>

    <div>
      <h3 class="font-semibold text-base mb-1">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
      ${edu.length? edu.map(e=>`<p>- ${escapeHtml(e.level)} / ${escapeHtml(e.institution)} (${escapeHtml(e.year)}) GPA: ${escapeHtml(e.gpa)}</p>`).join('') : '<p class="text-slate-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>'}
    </div>

    <div>
      <h3 class="font-semibold text-base mb-1">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
      ${exp.length? exp.map(ex=>`<p>- ${escapeHtml(ex.company)} | ${escapeHtml(ex.position)} (${escapeHtml(ex.period)})</p>`).join('') : '<p class="text-slate-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>'}
    </div>

    <div>
      <h3 class="font-semibold text-base mb-1">‡∏ó‡∏±‡∏Å‡∏©‡∏∞</h3>
      ${skills.length? skills.map(s=>`<span class='inline-block bg-slate-700 px-2 py-1 rounded mr-1 mb-1'>${escapeHtml(s.skill)}</span>`).join('') : '<p class="text-slate-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>'}
    </div>

    <div>
      <h3 class="font-semibold text-base mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏°</h3>
      ${misc.length? misc.map(m=>`<p>- ${escapeHtml(m.title)}: ${escapeHtml(m.detail)}</p>`).join('') : '<p class="text-slate-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>'}
    </div>
  `;
}

// ---------- Initial wiring ----------
document.addEventListener('DOMContentLoaded', ()=>{
  // basic buttons
  document.getElementById('save-personal-info')?.addEventListener('click', savePersonalInfoToServer);
  document.getElementById('add-education-btn')?.addEventListener('click', addEducation);
  document.getElementById('clear-education-btn')?.addEventListener('click', clearEducation);
  document.getElementById('add-experience-btn')?.addEventListener('click', addExperience);
  document.getElementById('clear-experience-btn')?.addEventListener('click', clearExperience);
  document.getElementById('add-skill-btn')?.addEventListener('click', addSkillFromInput);
  document.getElementById('skill-input')?.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); addSkillFromInput(); }});
  document.getElementById('clear-skills-btn')?.addEventListener('click', clearSkills);
  document.getElementById('add-misc-btn')?.addEventListener('click', addMisc);
  document.getElementById('clear-misc-btn')?.addEventListener('click', clearMisc);

  // modal buttons (attach after DOM ready)
  document.getElementById('edu-cancel')?.addEventListener('click', closeEduModal);
  document.getElementById('edu-save')?.addEventListener('click', async ()=>{
    const level = document.getElementById('edu-level').value;
    const institution = document.getElementById('edu-inst').value;
    const major = document.getElementById('edu-major').value;
    const year = document.getElementById('edu-year').value;
    const gpa = document.getElementById('edu-gpa').value;

    if(eduEditingId){
      await updateTableById('education', eduEditingId, { level, institution, major, year, gpa });
    } else {
      await insertTable('education', { level, institution, major, year, gpa });
    }
    closeEduModal(); renderEducation();
  });

  // experience modal buttons
  document.getElementById('exp-cancel')?.addEventListener('click', closeExpModal);
  document.getElementById('exp-save')?.addEventListener('click', async ()=>{
    const company = document.getElementById('exp-company').value;
    const position = document.getElementById('exp-position').value;
    const period = document.getElementById('exp-period').value;
    const responsibilities = document.getElementById('exp-resp').value;
    if(expEditingId){
      await updateTableById('experience', expEditingId, { company, position, period, responsibilities });
    } else {
      await insertTable('experience', { company, position, period, responsibilities });
    }
    closeExpModal(); renderExperience();
  });

  // render initial
  loadPersonalInfo(); renderEducation(); renderExperience(); loadSkills(); renderMisc();

  // --- FIX: Dashboard menu switching ---
  const menuProfile = document.getElementById('menu-profile-settings');
  const menuBio = document.getElementById('menu-personal-bio');
  const sectionProfile = document.getElementById('profile-settings');
  const sectionBio = document.getElementById('personal-bio-admin');

  if(menuProfile && menuBio && sectionProfile && sectionBio){
    menuProfile.onclick = () => {
      sectionProfile.classList.remove('hidden');
      sectionBio.classList.add('hidden');
    };
    menuBio.onclick = () => {
      sectionProfile.classList.add('hidden');
      sectionBio.classList.remove('hidden');
    };
  }
});
</script>

<script>
async function uploadFile(bucket, file) {
  if (!file) return null;
  const filePath = `${Date.now()}-${file.name}`;
  if(!supabase || !supabase.storage) { console.warn('Supabase storage not available'); return null; }
  const { data, error } = await supabase.storage.from(bucket).upload(filePath, file);
  if (error) { console.error('Upload error:', error); return null; }
  const { data: urlData } = supabase.storage.from(bucket).getPublicUrl(filePath);
  return urlData.publicUrl;
}

document.getElementById('save-profile-btn')?.addEventListener('click', async () => {
  const name = document.getElementById('artist-name').value;
  const bio = document.getElementById('artist-bio').value;
  const facebook = document.getElementById('artist-facebook').value;
  const bannerFile = document.getElementById('banner-upload').files[0];
  const avatarFile = document.getElementById('avatar-upload').files[0];

  let existing = { data: null };
  if(supabase){
    try{ existing = await supabase.from('profile').select('*').eq('id',1).single(); }catch(e){ console.warn('Could not fetch existing profile', e); }
  }

  const bannerUrl = bannerFile ? await uploadFile('profile-data', bannerFile) : existing.data?.banner_url;
  const avatarUrl = avatarFile ? await uploadFile('profile-data', avatarFile) : existing.data?.avatar_url;

  if(supabase){
    try{
      const { data, error } = await supabase.from('profile').upsert({ id: 1, name, bio, facebook, banner_url: bannerUrl, avatar_url: avatarUrl });
      if (error) { alert('‚ùå ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); console.error(error); return; }
    }catch(e){ console.warn('Profile upsert failed', e); }
  }

  const popup = document.createElement('div');
  popup.className = 'fixed top-5 right-5 bg-emerald-500 text-black px-4 py-2 rounded shadow-xl animate-pulse';
  popup.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
  document.body.appendChild(popup);
  setTimeout(() => popup.remove(), 2000);

  loadProfile();

  document.getElementById('artist-name').value = '';
  document.getElementById('artist-bio').value = '';
  document.getElementById('artist-facebook').value = '';
  document.getElementById('banner-upload').value = '';
  document.getElementById('avatar-upload').value = '';
});
</script>

<script>
// === Toggle Viewer / Admin ===
const viewerBtn = document.getElementById('viewerModeBtn');
const adminBtn = document.getElementById('adminModeBtn');
const viewerSection = document.getElementById('viewer-section');
const adminSection = document.getElementById('admin-section');

viewerBtn.onclick = () => {
  viewerSection.classList.remove('hidden');
  adminSection.classList.add('hidden');
  viewerBtn.classList.add('bg-slate-100','text-slate-900');
  adminBtn.classList.remove('bg-slate-100','text-slate-900');
};

adminBtn.onclick = () => {
  viewerSection.classList.add('hidden');
  adminSection.classList.remove('hidden');
  adminBtn.classList.add('bg-slate-100','text-slate-900');
  viewerBtn.classList.remove('bg-slate-100','text-slate-900');
};
</script>
